(this.webpackJsonpimmutablog=this.webpackJsonpimmutablog||[]).push([[0],{1122:function(e,t){},1124:function(e,t){},1489:function(e,t){},1643:function(e,t){},1652:function(e,t){},1654:function(e,t){},2056:function(e,t){},2105:function(e,t){},2164:function(e,t){},2176:function(e,t){},2251:function(e,t){},2253:function(e,t){},2734:function(e,t,n){"use strict";n.r(t);var a,r=n(169),s=n.n(r),c=n(888),o=n.n(c),i=(n(896),n(105)),u=n(36),l=n(891),h=n(890),b=n(0),f=n.n(b),p=n(170),d=n(533),j=n(534),g=n(50),v=n(26),x=n(54),m=n(889),O=n.n(m),w=n(76),y=n.n(w),k=n(24),S=function(){function e(t){Object(d.a)(this,e),this.tail=t}return Object(j.a)(e,[{key:Symbol.asyncIterator,value:function(){var e=this;return Object(x.a)(f.a.mark((function t(){var n,r,s;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.tail;case 1:if(!n){t.next=12;break}return console.log(n),t.next=5,Object(v.a)(a.dag.get(n));case 5:return s=t.sent.value,r=n,n=s.prev?s.prev.toString():null,t.next=10,Object(p.a)(Object(p.a)({},s),{},{hash:r});case 10:t.next=1;break;case 12:case"end":return t.stop()}}),t)})))()}}]),e}();function L(e){var t=e.hash,n=e.name,a=e.body;return Object(k.jsx)("div",{style:{display:"block"},children:Object(k.jsx)("table",{children:Object(k.jsxs)("tbody",{children:[Object(k.jsx)("tr",{children:Object(k.jsx)("td",{colSpan:"2",children:Object(k.jsx)("pre",{children:t})})}),Object(k.jsxs)("tr",{children:[Object(k.jsx)("td",{children:"Name"}),Object(k.jsx)("td",{children:n})]}),Object(k.jsxs)("tr",{children:[Object(k.jsx)("td",{children:"Body"}),Object(k.jsx)("td",{children:a})]})]})})})}var F=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(d.a)(this,n),e=t.call(this);var a=localStorage.getItem("immutablog-ipns");return e.state={name:null,hash:null,head:null,following:{},log:[],ipns:a,age:0},e}return Object(j.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.create({EXPERIMENTAL:{pubsub:!0,namesysPubsub:!0}});case 2:if(a=e.sent,window.ipfs=a,!this.state.ipns){e.next=7;break}return e.next=7,this.load(this.state.ipns);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.stop();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeadOfFollowing",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.table(t),n=Object.keys(t).map(function(){var e=Object(u.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("name: ".concat(t[n])),e.t0=console,e.next=4,a.name.resolve(t[n]);case 4:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),e.t2=S,e.next=9,y()(a.name.resolve(t[n]));case 9:return e.t3=e.sent,e.abrupt("return",new e.t2(e.t3));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),console.log(n),e.next=5,Promise.all(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLog",value:function(){var e=Object(u.a)(f.a.mark((function e(t,n){var a,r,s,c,o,i,u,l,h,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.state.age,console.table({head:t,following:n}),r=[],console.log("head: ".concat(t)),s=new S(t),c=!0,o=!1,e.prev=7,u=Object(g.a)(s);case 9:return e.next=11,u.next();case 11:return l=e.sent,c=l.done,e.next=15,l.value;case 15:if(h=e.sent,c){e.next=24;break}b=h,console.table(b),r.push(b),b.age>a&&this.setState({age:b.age});case 21:c=!0,e.next=9;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(7),o=!0,i=e.t0;case 30:if(e.prev=30,e.prev=31,c||null==u.return){e.next=35;break}return e.next=35,u.return();case 35:if(e.prev=35,!o){e.next=38;break}throw i;case 38:return e.finish(35);case 39:return e.finish(30);case 40:return e.abrupt("return",r);case 41:case"end":return e.stop()}}),e,this,[[7,26,30,40],[31,,35,39]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createVersion",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n,a,r,s,c,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("name: ".concat(t)),console.table(this.state),n=this.state,a=n.head,r=n.following,s=void 0===r?{}:r,e.next=5,this.getLog(a,s);case 5:return c=e.sent,e.next=8,this.save({name:t,log:c});case 8:o=e.sent,console.log("hash: ".concat(o));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createLog",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n,r,s,c,o,i,u,l,h,b,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.table(this.state),n=this.state,r=n.ipns,s=n.hash,c=n.head,o=n.name,i=n.log,u=void 0===i?[]:i,l=this.state.age,e.next=5,a.dag.put({from:r,fromHash:s,prev:c,age:l++,name:o,body:t});case 5:return h=e.sent,b=h.toString(),p={name:o,body:t,head:b,hash:b},u.unshift(p),a.pubsub.publish(r,JSON.stringify(p)),e.next=12,this.save({name:o,head:b,log:u,age:l});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n,r,s,c,o,i,l,h,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("load(".concat(t,")")),console.table(this.state),e.next=4,y()(a.name.resolve(t));case 4:return n=e.sent,console.log("hash: ".concat(n)),e.next=8,a.dag.get(n);case 8:return r=e.sent.value,s=r.name,c=void 0===s?"":s,o=r.head,i=r.following,l=r.age,h=null!==o&&void 0!==o?o.toString():null,e.next=17,this.getLog(h,i);case 17:if(b=e.sent,!i){e.next=21;break}return e.next=21,Promise.all(Object.values(i).map(function(){var e=Object(u.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("subscribing: ".concat(t)),a.pubsub.subscribe(t,(function(e){var n=e.from,a=e.data;if(console.log("received data: ",{from:n,data:a.toString()}),t===n){var r=JSON.parse(a.toString());l<r.age&&(l=r.age),b.unshift(r)}}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 21:this.setState({hash:n,name:c,head:h,following:i,log:b,age:l}),console.table(this.state);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n,r,s,c,o,i,u,l,h,b,p,d,j,g,v;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=void 0===n?this.state.name:n,s=t.hash,c=void 0===s?this.state.hash:s,o=t.head,i=void 0===o?this.state.head:o,u=t.following,l=void 0===u?this.state.following:u,h=t.log,b=void 0===h?this.state.log:h,p=t.age,d=void 0===p?this.state.age+1:p,console.table({name:r,hash:c,head:i,following:l,log:b,age:d}),e.next=4,a.dag.put({parent:c,name:r,head:i,following:l,age:d});case 4:return j=e.sent,g=j.toString(),e.next=8,a.name.publish(j);case 8:return v=e.sent,localStorage.setItem("immutablog-ipns",v.name),this.setState({name:r,hash:g,head:i,following:l,log:b,ipns:v.name,age:d}),console.table(this.state),e.abrupt("return",g);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.hash,a=t.ipns,r=t.following,s=void 0===r?{}:r,c=t.log,o=void 0===c?[]:c;return a?(console.table(this.state),Object(k.jsxs)("div",{children:[Object(k.jsxs)("pre",{children:["/ipns/",a]}),Object(k.jsx)("pre",{children:n}),Object(k.jsxs)("div",{children:[Object(k.jsx)("h4",{children:"Following"}),Object(k.jsx)("form",{onSubmit:function(t){t.preventDefault();var n=t.target.name.value,a=t.target.cid.value;t.target.name.value="",t.target.cid.value="",e.save({name:n,following:Object(p.a)(Object(p.a)({},s),{},Object(i.a)({},n,a))})},children:Object(k.jsx)("table",{children:Object(k.jsxs)("tbody",{children:[Object.keys(s).sort().map((function(e){return Object(k.jsxs)("tr",{children:[Object(k.jsx)("td",{children:e}),Object(k.jsx)("td",{children:Object(k.jsx)("pre",{children:s[e]})})]},e)})),Object(k.jsxs)("tr",{children:[Object(k.jsxs)("td",{children:["name",Object(k.jsx)("br",{}),Object(k.jsx)("input",{name:"name"})]}),Object(k.jsxs)("td",{children:["ipns",Object(k.jsx)("br",{}),Object(k.jsx)("input",{name:"cid"}),Object(k.jsx)("input",{type:"submit",value:"+"})]})]})]})})})]}),Object(k.jsx)("h4",{children:"What's happening?"}),Object(k.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.createLog(t.target.body.value),t.target.body.value=""},children:[Object(k.jsx)("textarea",{name:"body"}),Object(k.jsx)("input",{type:"submit"})]}),Object(k.jsx)("h4",{children:"Log"}),o.map((function(e){return Object(k.jsx)(L,Object(p.a)({},e),e.hash)}))]})):Object(k.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.createVersion(t.target.name.value)},children:["Your name: ",Object(k.jsx)("input",{name:"name"}),Object(k.jsx)("input",{type:"submit"})]})}}]),n}(r.Component),I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,2735)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),s(e),c(e)}))};o.a.render(Object(k.jsx)(s.a.StrictMode,{children:Object(k.jsx)(F,{})}),document.getElementById("root")),I()},325:function(e,t){},896:function(e,t,n){},898:function(e,t){},907:function(e,t){},986:function(e,t){},987:function(e,t){}},[[2734,1,2]]]);
//# sourceMappingURL=main.fba3ce2a.chunk.js.map